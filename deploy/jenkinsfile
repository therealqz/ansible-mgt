  pipeline {
    agent any
  stages {

   stage('Initial cleanUp') {
         steps { 
          dir("${WORKSPACE}") {
            deleteDir()
   }
         }
   }

    stage('CheckOut SCM') {
      steps {
        script {
         git branch: 'main', url: 'https://github.com/therealqz/ansible-mgt'
        }
      }
    }

    steps ("Package App") {steps {script {sh 'echo "packaging app"'}}}
    steps ("deploying to Dev") {steps {script {sh 'echo "Deploying To Dev'}}}
    stage('Run-AnsiblePlaybook') {
      steps {
        script {
          ansiblePlaybook credentialsId: 'e4ab9107-cc5b-4891-92d9-2a592b6191df', disableHostKeyChecking: true, installation: 'ansible', inventory: '/home/ec2-user/ansible-mgt/inventory/dev.yml', playbook: '/home/ec2-user/ansible-mgt/playbooks/site.yml'
        }
      }
    }

      stage ("clean up") {
       steps {
        cleanWs{}
       }
    }
}
